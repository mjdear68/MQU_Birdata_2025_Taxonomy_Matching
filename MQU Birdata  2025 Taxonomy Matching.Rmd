---
title: "MQU Birdata  2025 Taxonomy Matching"
author: "Michael Dear"
date: "2025-07-07"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Introduction
This project aims to match the Birdata (BD) taxonomy to the Atlas of Living Australia (ALA) taxonomy. The scope is all bird species identified in either BD or ALA for the given study area. The overall goal is to produce a dataset in which BD data is incorporated into the ALA data using ALA scientific and common names.

## Method
An iterative approach is taken to matching. Exact matches on either scientific name or common name are resolved first. The residual records are matched using approximate matching techniques. BD is taken as the source and is matched against ALA. A translation table is produced in which BD names are matched against ALA names. The translation table is tested on a subset of BD data and reviewed for accuracy.

## Data Sources

### Birdata
Species names for a KBA can be obtained from BD (https://birdata.birdlife.org.au/) by
* Select 'Key Biodiversity Areas' in 'Area Layer' in the left panel
* Select the relevant KBA in 'Area'
* Leave all other settings as defaults
* Click the download icon next to 'Species List' in the right panel
* Repeat this process for each KBA 
* Rename the files to identify them with their respective KBAs
* Move the files into the './Input/BD' folder in this project

### ALA
Species names for a KBA can be obtained from ALA (https://ala.org.au/) by
* Opening the 'Spatial Analysis' from the 'Search and Analyse' menu at the top of the home page
* Upload the shape file for a KBA from the './Shapefiles' directory in this project
* Open 'Area Report - interactive' from the 'Tools' menu at the top of the left panel
* Scroll down and click the 'List' button next 'Birds' 
* Click the 'Download' button once the list opens
* Repeat this process for each KBA 
* Rename the files to identify them with their respective KBAs
* Move the files into the './Input/ALA' folder in this project

## References
* "Fuzzy Matching in R (Example) | Approximate String, Name & Text Search | adist(), agrep() & amatch()", https://youtu.be/txHkNr29w20?si=XSQiEHiplcBrwc0x, for approximate matching using `stringdist::amatch` 

# Setup
```{r setup}
# Clear the environment
rm(list=ls())

# Libraries
library(stringdist)
library(tidyverse)
```


# Data Preparation
Read the directories of CSV's into data frames.

```{r function to read a directory of files into a data frame}
readDIR <- function(path, 
                    skip=0, 
                    delim=",",
                    cols,
                    na_strings=c("", "NA"),
                    str_replace_pattern=c(" " = "_", "-" = "_", "\\[" = "", "\\]" = "")
){
  # Read the directory of files
	list_of_files <- list.files(path = path,
		recursive = TRUE,
		pattern = "\\.csv$",
		full.names = TRUE)
	
	out <- lapply(list_of_files, function(x){
  	  df <- read_delim(x, delim=delim, skip=skip, na = na_strings, 
  	                   name_repair = function(n){str_replace_all(n, str_replace_pattern)})
  	  df <- df |> select(cols)
	  }) |>
	    bind_rows() |> distinct() # Collapse list into a single data frame
	
	return(out)
}
```

```{r read in the species files}
BD_species <- readDIR(path="./Input/BD/", cols=c(1:2)) |> relocate(2,1)

ALA_species <- readDIR(path="./Input/ALA/", cols=c("Species_Name", "Vernacular_Name")) |> rename("Scientific_Name"="Species_Name", "Common_Name"="Vernacular_Name")
```

Check the data frame structures, missing values etc.
```{r data frame check}
summary(BD_species)
str(BD_species)
sapply(colnames(BD_species), function(x) sum(is.na(BD_species[,x])))

summary(ALA_species)
str(ALA_species)
sapply(colnames(ALA_species), function(x) sum(is.na(ALA_species[,x])))

```


# Match Taxonomies

# Accuracy Assessment